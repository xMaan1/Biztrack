"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9179],{15863:function(e,r,t){t.d(r,{Z:function(){return a}});let a=(0,t(39763).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},50749:function(e,r,t){t.d(r,{default:function(){return m}});var a=t(57437),s=t(2265),n=t(79820),l=t(12381),i=t(40279),o=t(75060),d=t(95937),c=t(15863),u=t(14362),f=t(89441);function m(e){let{mode:r,onSuccess:t}=e,{login:m}=(0,u.a)(),[g,x]=(0,s.useState)({userName:"",email:"",password:"",firstName:"",lastName:""}),[p,h]=(0,s.useState)(!1),[v,w]=(0,s.useState)(""),N=async e=>{e.preventDefault(),h(!0),w("");try{"login"===r?await m({email:g.email,password:g.password})?t():w("Invalid email or password"):await f.Ew.register({userName:g.userName,email:g.email,password:g.password,firstName:g.firstName,lastName:g.lastName})&&(await m({email:g.email,password:g.password})?t():w("Registration successful but automatic login failed. Please sign in manually."))}catch(e){if(console.error("Auth error:",e),e.response){var a,s;w((null===(a=e.response.data)||void 0===a?void 0:a.detail)||(null===(s=e.response.data)||void 0===s?void 0:s.message)||"An error occurred")}else e.request?w("No response from server. Please check your connection."):w(e.message||"An error occurred")}finally{h(!1)}};return(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 p-4",children:(0,a.jsxs)(n.Zb,{className:"w-full max-w-md modern-card",children:[(0,a.jsxs)(n.Ol,{className:"text-center",children:[(0,a.jsx)(n.ll,{className:"text-2xl font-bold bg-gradient-primary bg-clip-text text-transparent",children:"login"===r?"Welcome Back":"Create Account"}),(0,a.jsx)("p",{className:"text-gray-600 mt-2",children:"login"===r?"Sign in to your account":"Sign up to get started"})]}),(0,a.jsx)(n.aY,{children:(0,a.jsxs)("form",{onSubmit:N,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o._,{htmlFor:"email",children:"Email"}),(0,a.jsx)(i.I,{id:"email",type:"email",required:!0,value:g.email,onChange:e=>x({...g,email:e.target.value}),className:"w-full"})]}),"signup"===r&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o._,{htmlFor:"userName",children:"Username"}),(0,a.jsx)(i.I,{id:"userName",required:!0,value:g.userName,onChange:e=>x({...g,userName:e.target.value}),className:"w-full"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o._,{htmlFor:"firstName",children:"First Name"}),(0,a.jsx)(i.I,{id:"firstName",value:g.firstName,onChange:e=>x({...g,firstName:e.target.value}),className:"w-full"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o._,{htmlFor:"lastName",children:"Last Name"}),(0,a.jsx)(i.I,{id:"lastName",value:g.lastName,onChange:e=>x({...g,lastName:e.target.value}),className:"w-full"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o._,{htmlFor:"password",children:"Password"}),(0,a.jsx)(i.I,{id:"password",type:"password",required:!0,value:g.password,onChange:e=>x({...g,password:e.target.value}),className:"w-full"})]}),v&&(0,a.jsx)(d.bZ,{className:"border-red-200 bg-red-50",children:(0,a.jsx)(d.X,{className:"text-red-800",children:v})}),(0,a.jsx)(l.z,{type:"submit",disabled:p,className:"w-full modern-button",children:p?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Please wait"]}):"login"===r?"Sign In":"Create Account"})]})})]})})}},53195:function(e,r,t){t.d(r,{default:function(){return i}});var a=t(57437),s=t(2265),n=t(99376),l=t(14362);function i(e){let{children:r}=e,{user:t,loading:i,isAuthenticated:o}=(0,l.a)(),d=(0,n.useRouter)(),c=(0,n.usePathname)(),u=["/","/login","/signup","/client-portal","/api","/_next","/favicon.ico","/manifest.json"],f=["/dashboard","/inventory","/pos","/crm","/sales","/time-tracking","/team","/projects","/events","/tasks","/users","/workspace","/reports","/hrm","/production"],m=(0,s.useMemo)(()=>u.some(e=>null==c?void 0:c.startsWith(e)),[c]),g=(0,s.useMemo)(()=>f.some(e=>null==c?void 0:c.startsWith(e)),[c]);return((0,s.useEffect)(()=>{if(!i){if(!o&&g){console.log("Unauthenticated user trying to access protected route:",c),d.push("/login");return}if(o&&("/login"===c||"/signup"===c)){console.log("Authenticated user trying to access auth pages, redirecting to dashboard"),d.push("/dashboard");return}}},[o,i,c,d,g]),i)?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,a.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,a.jsx)("div",{className:"w-16 h-16 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin"}),(0,a.jsx)("p",{className:"text-gray-600 font-medium",children:"Initializing..."}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Please wait while we verify your session"})]})}):m?(0,a.jsx)(a.Fragment,{children:r}):o?(0,a.jsx)(a.Fragment,{children:r}):(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,a.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,a.jsx)("div",{className:"w-8 h-8 border-2 border-red-200 border-t-red-600 rounded-full animate-spin"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Redirecting to login..."})]})})}},95937:function(e,r,t){t.d(r,{X:function(){return d},bZ:function(){return o}});var a=t(57437),s=t(2265),n=t(90535),l=t(93448);let i=(0,n.j)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive",success:"border-green-500/50 text-green-700 bg-green-50 [&>svg]:text-green-600",warning:"border-yellow-500/50 text-yellow-700 bg-yellow-50 [&>svg]:text-yellow-600",info:"border-blue-500/50 text-blue-700 bg-blue-50 [&>svg]:text-blue-600"}},defaultVariants:{variant:"default"}}),o=s.forwardRef((e,r)=>{let{className:t,variant:s,...n}=e;return(0,a.jsx)("div",{ref:r,role:"alert",className:(0,l.cn)(i({variant:s}),t),...n})});o.displayName="Alert",s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("h5",{ref:r,className:(0,l.cn)("mb-1 font-medium leading-none tracking-tight",t),...s})}).displayName="AlertTitle";let d=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:(0,l.cn)("text-sm [&_p]:leading-relaxed",t),...s})});d.displayName="AlertDescription"},79820:function(e,r,t){t.d(r,{Ol:function(){return i},SZ:function(){return d},Zb:function(){return l},aY:function(){return c},ll:function(){return o}});var a=t(57437),s=t(2265),n=t(93448);let l=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...s})});l.displayName="Card";let i=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",t),...s})});i.displayName="CardHeader";let o=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("h3",{ref:r,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",t),...s})});o.displayName="CardTitle";let d=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("p",{ref:r,className:(0,n.cn)("text-sm text-muted-foreground",t),...s})});d.displayName="CardDescription";let c=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:(0,n.cn)("p-6 pt-0",t),...s})});c.displayName="CardContent",s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:(0,n.cn)("flex items-center p-6 pt-0",t),...s})}).displayName="CardFooter"},40279:function(e,r,t){t.d(r,{I:function(){return l}});var a=t(57437),s=t(2265),n=t(93448);let l=s.forwardRef((e,r)=>{let{className:t,type:s,...l}=e;return(0,a.jsx)("input",{type:s,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,...l})});l.displayName="Input"},75060:function(e,r,t){t.d(r,{_:function(){return d}});var a=t(57437),s=t(2265),n=t(6394),l=t(90535),i=t(93448);let o=(0,l.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)(n.f,{ref:r,className:(0,i.cn)(o(),t),...s})});d.displayName=n.f.displayName},14362:function(e,r,t){t.d(r,{AuthProvider:function(){return o},a:function(){return d}});var a=t(57437),s=t(2265),n=t(89441),l=t(60621);let i=(0,s.createContext)(void 0);function o(e){let{children:r}=e,[t,o]=(0,s.useState)(null),[d,c]=(0,s.useState)(!0),[u,f]=(0,s.useState)([]),[m,g]=(0,s.useState)(null);(0,s.useEffect)(()=>{(async()=>{try{let e=new l.S;if(e.isSessionValid()){if(e.isTokenExpired()&&!await e.refreshAccessToken()){e.clearSession(),o(null),c(!1);return}let r=e.getSession();if(r&&r.token&&r.user){o(r.user);let e=n.Ew.getUserTenants();if(e.length>0){f(e);let r=n.Ew.getCurrentTenant();r?g(r):(g(e[0]),n.Ew.setTenantId(e[0].id))}}else e.clearSession(),o(null)}else e.clearSession(),o(null)}catch(e){console.error("AuthContext - Auth initialization error:",e),new l.S().clearSession(),o(null)}finally{c(!1)}})()},[]);let x=async e=>{try{c(!0);let r=await n.Ew.login(e);if(r.success&&r.user){o(r.user);let e=n.Ew.getUserTenants();if(e.length>0){f(e);let r=n.Ew.getCurrentTenant();r&&g(r)}return!0}return!1}catch(e){return console.error("AuthContext - Login failed:",e),!1}finally{c(!1)}},p=async()=>{try{await n.Ew.logout()}catch(e){console.error("AuthContext - Logout error:",e)}finally{let e=new l.S;o(null),f([]),g(null),e.clearSession(),n.Ew.setTenantId(null),window.location.href="/login"}},h=async e=>{try{let r=await n.Ew.switchTenant(e);return g(r),!0}catch(e){return console.error("AuthContext - Failed to switch tenant:",e),!1}};return(0,a.jsx)(i.Provider,{value:{user:t,loading:d,isAuthenticated:!!t,tenants:u,currentTenant:m,login:x,logout:p,switchTenant:h},children:r})}function d(){let e=(0,s.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},6394:function(e,r,t){t.d(r,{f:function(){return i}});var a=t(2265),s=t(66840),n=t(57437),l=a.forwardRef((e,r)=>(0,n.jsx)(s.WV.label,{...e,ref:r,onMouseDown:r=>{var t;r.target.closest("button, input, select, textarea")||(null===(t=e.onMouseDown)||void 0===t||t.call(e,r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));l.displayName="Label";var i=l}}]);