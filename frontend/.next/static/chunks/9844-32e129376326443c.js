"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9844],{76070:function(e,t,a){a.d(t,{g:function(){return N}});var r=a(57437),s=a(2265),n=a(74291),l=a(12381),i=a(40279),d=a(75060),c=a(23675),o=a(15291),m=a(69174),u=a(95252),p=a(15863),x=a(32489),h=a(29501),j=a(73842),g=a(34422),v=a(89441);let f=g.Ry({name:g.Z_().required("Project name is required"),description:g.Z_().required("Description is required"),status:g.Z_().required("Status is required"),priority:g.Z_().required("Priority is required"),startDate:g.hT().required("Start date is required"),endDate:g.hT().required("End date is required").min(g.iH("startDate"),"End date must be after start date"),budget:g.Rx().positive("Budget must be positive").nullable(),projectManagerId:g.Z_().required("Project manager is required"),teamMemberIds:g.IX().of(g.Z_()).min(1,"At least one team member is required"),clientEmail:g.Z_().email("Invalid email format").nullable(),notes:g.Z_().nullable()});function N(e){let{open:t,onClose:a,onSave:g,project:N,mode:b}=e,[y,w]=(0,s.useState)(!1),[D,I]=(0,s.useState)([]),[_,C]=(0,s.useState)([]),[E,S]=(0,s.useState)([]),[M,Q]=(0,s.useState)(!1),[P,q]=(0,s.useState)([]),{control:k,handleSubmit:Z,reset:R,watch:F,setValue:T,formState:{errors:V}}=(0,h.cI)({resolver:(0,j.X)(f),defaultValues:{name:"",description:"",status:"planning",priority:"medium",startDate:new Date,endDate:new Date,budget:null,projectManagerId:"",teamMemberIds:[],clientEmail:"",notes:""}}),B=F("teamMemberIds");(0,s.useEffect)(()=>{let e=async()=>{try{Q(!0);let e=v.Ew.getTenantId();if(!e)return;let t=await v.Ew.getTenantUsers(e),a=(null==t?void 0:t.users)||t||[];a=a.map(e=>({...e,id:e.id||e.userId})),I(a),C(a.filter(e=>"project_manager"===e.userRole||"admin"===e.userRole)),S(a.filter(e=>"team_member"===e.userRole||"project_manager"===e.userRole||"admin"===e.userRole))}catch(e){console.error("Error fetching users:",e)}finally{Q(!1)}};t&&e()},[t]),(0,s.useEffect)(()=>{if(N&&"edit"===b){var e;R({name:N.name,description:N.description,status:N.status,priority:N.priority,startDate:new Date(N.startDate),endDate:new Date(N.endDate),budget:N.budget,projectManagerId:N.projectManager.id,teamMemberIds:(null===(e=N.teamMembers)||void 0===e?void 0:e.map(e=>e.id))||[],clientEmail:N.clientEmail||"",notes:N.notes||""}),q((N.teamMembers||[]).map(e=>({id:e.id,userName:e.name,userRole:"team_member",email:e.email,firstName:e.name.split(" ")[0]||"",lastName:e.name.split(" ").slice(1).join(" ")||"",avatar:e.avatar})))}else"create"===b&&(R({name:"",description:"",status:"planning",priority:"medium",startDate:new Date,endDate:new Date,budget:null,projectManagerId:"",teamMemberIds:[],clientEmail:"",notes:""}),q([]))},[N,b,R]),(0,s.useEffect)(()=>{q(E.filter(e=>null==B?void 0:B.includes(e.id)))},[B,E]);let O=async e=>{try{let t;w(!0);let r={...e,startDate:e.startDate.toISOString().split("T")[0],endDate:e.endDate.toISOString().split("T")[0],budget:e.budget||void 0,clientEmail:e.clientEmail||void 0,notes:e.notes||void 0};t="create"===b?await v.Ew.createProject(r):await v.Ew.updateProject(N.id,r),g(t),a()}catch(e){console.error("Error saving project:",e)}finally{w(!1)}},z=e=>{let t=B||[];T("teamMemberIds",t.includes(e)?t.filter(t=>t!==e):[...t,e])},U=()=>{y||a()};return(0,r.jsx)(n.Vq,{open:t,onOpenChange:U,children:(0,r.jsxs)(n.cZ,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[(0,r.jsxs)(n.fK,{children:[(0,r.jsx)(n.$N,{children:"create"===b?"Create New Project":"Edit Project"}),(0,r.jsx)(n.Be,{children:"create"===b?"Fill in the details to create a new project":"Update the project information"})]}),(0,r.jsxs)("form",{onSubmit:Z(O),className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"md:col-span-2 space-y-2",children:[(0,r.jsx)(d._,{htmlFor:"name",children:"Project Name *"}),(0,r.jsx)(h.Qr,{name:"name",control:k,render:e=>{let{field:t}=e;return(0,r.jsx)(i.I,{...t,id:"name",placeholder:"Enter project name",className:V.name?"border-red-500":""})}}),V.name&&(0,r.jsx)("p",{className:"text-sm text-red-600",children:V.name.message})]}),(0,r.jsxs)("div",{className:"md:col-span-2 space-y-2",children:[(0,r.jsx)(d._,{htmlFor:"description",children:"Description *"}),(0,r.jsx)(h.Qr,{name:"description",control:k,render:e=>{let{field:t}=e;return(0,r.jsx)(c.g,{...t,id:"description",placeholder:"Enter project description",rows:3,className:V.description?"border-red-500":""})}}),V.description&&(0,r.jsx)("p",{className:"text-sm text-red-600",children:V.description.message})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d._,{children:"Status *"}),(0,r.jsx)(h.Qr,{name:"status",control:k,render:e=>{let{field:t}=e;return(0,r.jsxs)(o.Ph,{value:t.value,onValueChange:t.onChange,children:[(0,r.jsx)(o.i4,{children:(0,r.jsx)(o.ki,{placeholder:"Select status"})}),(0,r.jsxs)(o.Bw,{children:[(0,r.jsx)(o.Ql,{value:"planning",children:"Planning"}),(0,r.jsx)(o.Ql,{value:"in_progress",children:"In Progress"}),(0,r.jsx)(o.Ql,{value:"on_hold",children:"On Hold"}),(0,r.jsx)(o.Ql,{value:"completed",children:"Completed"}),(0,r.jsx)(o.Ql,{value:"cancelled",children:"Cancelled"})]})]})}})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d._,{children:"Priority *"}),(0,r.jsx)(h.Qr,{name:"priority",control:k,render:e=>{let{field:t}=e;return(0,r.jsxs)(o.Ph,{value:t.value,onValueChange:t.onChange,children:[(0,r.jsx)(o.i4,{children:(0,r.jsx)(o.ki,{placeholder:"Select priority"})}),(0,r.jsxs)(o.Bw,{children:[(0,r.jsx)(o.Ql,{value:"low",children:"Low"}),(0,r.jsx)(o.Ql,{value:"medium",children:"Medium"}),(0,r.jsx)(o.Ql,{value:"high",children:"High"}),(0,r.jsx)(o.Ql,{value:"critical",children:"Critical"})]})]})}})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d._,{htmlFor:"startDate",children:"Start Date *"}),(0,r.jsx)(h.Qr,{name:"startDate",control:k,render:e=>{let{field:t}=e;return(0,r.jsx)(i.I,{type:"date",value:t.value?t.value.toISOString().split("T")[0]:"",onChange:e=>t.onChange(new Date(e.target.value)),className:V.startDate?"border-red-500":""})}}),V.startDate&&(0,r.jsx)("p",{className:"text-sm text-red-600",children:V.startDate.message})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d._,{htmlFor:"endDate",children:"End Date *"}),(0,r.jsx)(h.Qr,{name:"endDate",control:k,render:e=>{let{field:t}=e;return(0,r.jsx)(i.I,{type:"date",value:t.value?t.value.toISOString().split("T")[0]:"",onChange:e=>t.onChange(new Date(e.target.value)),className:V.endDate?"border-red-500":""})}}),V.endDate&&(0,r.jsx)("p",{className:"text-sm text-red-600",children:V.endDate.message})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d._,{htmlFor:"budget",children:"Budget"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(u.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),(0,r.jsx)(h.Qr,{name:"budget",control:k,render:e=>{let{field:t}=e;return(0,r.jsx)(i.I,{...t,type:"number",placeholder:"0.00",className:"pl-10",value:t.value||"",onChange:e=>t.onChange(e.target.value?parseFloat(e.target.value):null)})}})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d._,{htmlFor:"clientEmail",children:"Client Email"}),(0,r.jsx)(h.Qr,{name:"clientEmail",control:k,render:e=>{let{field:t}=e;return(0,r.jsx)(i.I,{...t,type:"email",placeholder:"client@example.com",value:t.value||""})}})]}),(0,r.jsxs)("div",{className:"md:col-span-2 space-y-2",children:[(0,r.jsx)(d._,{children:"Project Manager *"}),(0,r.jsx)(h.Qr,{name:"projectManagerId",control:k,render:e=>{let{field:t}=e;return(0,r.jsxs)(o.Ph,{value:t.value,onValueChange:t.onChange,children:[(0,r.jsx)(o.i4,{children:(0,r.jsx)(o.ki,{placeholder:"Select project manager"})}),(0,r.jsx)(o.Bw,{children:_.map(e=>(0,r.jsxs)(o.Ql,{value:e.id,children:[e.firstName||e.userName," (",e.email,")"]},e.id))})]})}}),V.projectManagerId&&(0,r.jsx)("p",{className:"text-sm text-red-600",children:V.projectManagerId.message})]}),(0,r.jsxs)("div",{className:"md:col-span-2 space-y-2",children:[(0,r.jsx)(d._,{children:"Team Members *"}),(0,r.jsx)("div",{className:"border rounded-lg p-3 max-h-40 overflow-y-auto",children:M?(0,r.jsxs)("div",{className:"flex items-center justify-center py-4",children:[(0,r.jsx)(p.Z,{className:"h-4 w-4 animate-spin"}),(0,r.jsx)("span",{className:"ml-2 text-sm text-gray-600",children:"Loading users..."})]}):(0,r.jsx)("div",{className:"space-y-2",children:E.map(e=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-2 hover:bg-gray-50 rounded cursor-pointer",onClick:()=>z(e.id),children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium",children:e.firstName||e.userName}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:e.email})]}),(0,r.jsx)("input",{type:"checkbox",checked:(null==B?void 0:B.includes(e.id))||!1,onChange:()=>z(e.id),className:"rounded"})]},e.id))})}),P.length>0&&(0,r.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:P.map(e=>(0,r.jsxs)(m.C,{variant:"secondary",className:"text-xs",children:[e.firstName||e.userName,(0,r.jsx)("button",{type:"button",onClick:()=>z(e.id),className:"ml-1 hover:text-red-600",children:(0,r.jsx)(x.Z,{className:"h-3 w-3"})})]},e.id))}),V.teamMemberIds&&(0,r.jsx)("p",{className:"text-sm text-red-600",children:V.teamMemberIds.message})]}),(0,r.jsxs)("div",{className:"md:col-span-2 space-y-2",children:[(0,r.jsx)(d._,{htmlFor:"notes",children:"Notes"}),(0,r.jsx)(h.Qr,{name:"notes",control:k,render:e=>{let{field:t}=e;return(0,r.jsx)(c.g,{...t,id:"notes",placeholder:"Additional project notes...",rows:3,value:t.value||""})}})]})]}),(0,r.jsxs)(n.cN,{children:[(0,r.jsx)(l.z,{type:"button",variant:"outline",onClick:U,disabled:y,children:"Cancel"}),(0,r.jsx)(l.z,{type:"submit",disabled:y,className:"modern-button",children:y?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(p.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):"create"===b?"Create Project":"Update Project"})]})]})]})})}},17168:function(e,t,a){a.d(t,{SP:function(){return c},dr:function(){return d},mQ:function(){return i},nU:function(){return o}});var r=a(57437),s=a(2265),n=a(20271),l=a(93448);let i=n.fC,d=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.aV,{ref:t,className:(0,l.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",a),...s})});d.displayName=n.aV.displayName;let c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.xz,{ref:t,className:(0,l.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",a),...s})});c.displayName=n.xz.displayName;let o=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.VY,{ref:t,className:(0,l.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...s})});o.displayName=n.VY.displayName}}]);